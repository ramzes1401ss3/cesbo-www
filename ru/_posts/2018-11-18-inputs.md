---
layout: post
lang: ru
title: Input Address Format
tags: [dev]
---

Формат медиа-адреса

<!-- more -->

Медиа-адрес состоит из трех частей:

**```type://address#options```**

##### type

Описывает, какой тип источника следует использовать. Доступны следующие типы:  

- **udp** — UDP мультикаст, юникаст или броадкаст    
- **rtp** — протокол, основанный на UDP  
- **http** — HTTP-протокол. MPEG-TS, HLS (потоковое видео HTTP)  
- **dvb** — DVB адаптеры. прием данных от адаптеров DVB-S/S2, DVB-T/T2, DVB-C, ISDB-T, and ASI devices  
- **file** — MPEG-TS файлы  

##### address

Адрес источника

##### options

Параметры могут быть специальными и общими. Параметры должны делиться символом &. Например: 
**```dvb://a001#pnr=100&cam```**


#### Input specific options


### UDP/RTP

![Image](/assets/post-img/udp_in.png){:class="img-fluid"}

**```udp://[interface@]address[:port][#options]```**  
**```rtp://[interface@]address[:port][#options]```**  
- **interface** — IPv4 адрес или имя локального интерфейса. По умолчанию используется таблица маршрутизации.
- **address** — IPv4 адрес потока. Мультикаст или юникаст.  
- **port** — Номер порта. По умолчанию: 1234  
Дополнительные параметры:

**renew=INTERVAL** — обновление подписки на мультикаст-группу через заданное время (в секундах) 

Примеры:  
`udp://239.255.1.1`  
`udp://eth0@239.255.1.1`  
`udp://127.0.0.1:10000`  
`udp://239.255.1.1:1234#sync`  

### RTSP

```rtsp://[login:password@]address[:port][/path]```
- **login:password** — имя пользователя и пароль для авторизации rtsp  
- **address** — IPv4 адрес сервера или доменное имя
- **port** — Номер порта. По умолчанию: 554
- **path** — путь к ресурсу. Значение по умолчанию: /


### HTTP

![Image](/assets/post-img/http_in.png){:class="img-fluid"}

**`http://[login:password@]address[:port][/path]`**
- **login:password** — логин и пароль для http авторизации
- **address** —  IPv4 адрес или имя домена. 
 - **port** — номер порта. По умолчанию: 80
 - **path** — path to the resource. Default value: /

Additional options:
- **ua=USER-AGENT** — пользовательский User-Agent. Значение по умолчанию: Astra
- **timeout=TIMEOUT** — таймаут, в секундах, для установления соединения с сервером. Значение по умолчанию: 10  
- **buffer_size=SIZE** — размер буфера приема, в килобайтах. Значение по умолчанию: 1024
- **buffer_time=TIME** — Размер буфера в секундах - альтернатива параметру `buffer_size`

Для получения HTTPS-источника необходимо использовать дополнительный прокси-сервер, например nginx, поскольку Astra еще не поддерживает HTTPS.    
Создайте конфигурационный файл /etc/nginx/sites-enabled/astra с содержимым:  
```
server {
    listen 30000;
    server_name _;

    location / {
        proxy_cache off;
        expires -1;
        proxy_ssl_server_name on;
        proxy_pass https://example.com:8000;
    }
}
```
### MPEG-TS файл

![Image](/assets/post-img/file_in.png){:class="img-fluid"}

**```file://path```**
- **path** — путь до файла  
Дополнительные параметры:

**loop** — "зацикленное" воспроизведение файла. 
Пример:  

`file:///mnt/raid0/file.ts`

### Глобальные опции

 - **pnr=PNR** — номер программы, также известен как SID (Service ID). Извлечение канала с указанным номером из потока
 - **set_pnr=PNR** — изменить PNR. Значение должно быть в диапазоне от 1 до 65535
 - **set_tsid=TSID** — изменить TSID (Transport Stream ID)
 - **biss=1122330044556600** — BISS ключ для дешифрования потока
 - **cam** — использовать DVB-CI для дешифрования потока
 - **cam=CAM-ID** — использовать Softcam для дешифрования потока
 - **ecm_pid=PID** — установить ECM PID (не рекомендуется использовать)
 - **shift=X** — размер буфера дешифрования для входящего потока, в мегабитах, позволяет задержать дешифрование потока. Параметр может потребоваться для каналов "Sky". Для расчёта значения параметра, необходимо умножить битрейт потока на время задержки, в секундах. Например 10Мбит/с * 3 секунды получится shift=30
 - **cas — пропускать служебные данные о системах условного доступа. Используется для передачи зашифрованного потока
 - **filter=N,...** — фильтрация потока, убрать данные с указанными идентификаторами (PID). Идентификаторы перечисляются через запятую
 - **filter~=N,...** — фильтрация потока, убрать все данные кроме указанных идентификаторв (PID) и служебных таблиц. Идентификаторы перечисляются через запятую
 - **map.SRC=DST** — изменить идентификаторы данных (PID) на заданные значения. SRC - оригинальный идентификатор или тип данных. Возможные типы pmt, video, audio или код языка. DST - требуемый идентификатор. Значение может быть в диапазоне от 16 до 8190
 - **no_sdt** — удалить информацию о канале: название канала, название оператора. SDT - Service Description Table
 - **pass_sdt** — передача SDT без обработки. По умолчанию, если установлен параметр pnr, Astra передаёт информацию только по выбранному потоку
 - **no_eit** — удалить информацию о событиях: EPG. EIT - Event Information Table
 - **pass_eit** — передача EIT без обработки. По умолчанию, если установлен параметр pnr, Astra передаёт информацию только по выбранному потоку
 - **no_reload — отключить проверку изменений в потоке
 - **cc_limit=N** — установить лимит CC-ошибок. Если количество CC-ошибок больше установленного лимита, Astra попытается переключится на резервный источник. По умолчанию: лимит не установлен. CC (Continuity Counter) — последовательный номер пакетов с данными. CC-ошибка — нарушение последовательности пакетов из-за потери данных
 - **bitrate_limit=RATE** — установить минимальный битрейт для анализатора в Кбит/с. Источник будет считаться нерабочим если битрейт потока меньше указанного значения. По умолчанию: 16 Кбит/с для потока без видео данных и 128 Кбит/с для потока с видео данными
- **watchdog==XXX** - установка времени срабатывания таймера для перезапуска неисправного входящего потока, устанавливается в секундах. по умолчанию - 5 секунд. 
